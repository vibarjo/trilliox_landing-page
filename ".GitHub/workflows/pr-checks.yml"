name: PR Quality Checks

on:
  pull_request:
    branches: [ main, develop ]

jobs:
  pr-validation:
    runs-on: ubuntu-latest
    name: Validate PR

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Check PR title
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"
          echo "PR Title: $PR_TITLE"
          
          if [[ ! "$PR_TITLE" =~ ^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?:\ .{3,} ]]; then
            echo "⚠️ PR title should follow conventional commits format"
            echo "Format: <type>(<scope>): <subject>"
            echo "Example: feat(wallet): implement MetaMask detection"
          fi

      - name: Check for required files in changes
        run: |
          echo "Checking modified files..."
          git diff --name-only origin/main..HEAD | head -20

      - name: Verify no conflicting files
        run: |
          echo "Checking for merge conflicts..."
          if grep -r "^<<<<<<< HEAD" . --include="*.js" --include="*.html"; then
            echo "❌ Merge conflicts detected!"
            exit 1
          fi
          echo "✓ No merge conflicts"
